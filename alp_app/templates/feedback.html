{% extends 'base.html' %}
{% load static %}

{% block title %}Review Terminal | SSC{% endblock title %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<link rel="stylesheet" href="{% static 'fontawesome-free-7.1.0-web/css/all.min.css' %}">

<style>
    /* Card Glassmorphism Industrial (Sinkron dengan Katalog & About) */
    .industrial-glass-card {
        background-color: rgba(255, 255, 255, 0.05); 
        backdrop-filter: blur(12px); 
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(0, 0, 0, 0.1);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .industrial-glass-card:hover {
        border-color: rgba(0, 0, 0, 0.3);
        background-color: rgba(255, 255, 255, 0.15);
    }
    
    /* Star Rating Interaction */
    .star-rating { display: flex; flex-direction: row-reverse; justify-content: flex-end; gap: 12px; }
    .star-rating input { display: none; }
    .star-rating label { cursor: pointer; color: #d1d5db; transition: all 0.3s ease; font-size: 2.2rem; }
    .star-rating label:hover,
    .star-rating label:hover ~ label,
    .star-rating input:checked ~ label { 
        color: #eab308; 
        transform: scale(1.1);
        filter: drop-shadow(0 0 8px rgba(234, 179, 8, 0.4));
    }

    /* Industrial Input Styling (Sinkron dengan Katalog) */
    .cyber-input {
        background: #ffffff !important;
        border: 2px solid #111827 !important;
        color: #111827 !important;
        border-radius: 0px !important; 
        font-weight: 700 !important;
        transition: all 0.2s ease;
    }
    .cyber-input:focus {
        box-shadow: 4px 4px 0px #eab308 !important;
        transform: translate(-2px, -2px);
        outline: none;
    }
</style>

<div class="min-h-screen">
    <div class="container mx-auto px-6 pt-2 pb-12">
        
        {# Header Section - Gaya Katalog (Rata Kiri) #}
        <div class="w-full flex flex-col gap-1 mb-12" data-aos="fade-right">
            <div class="flex items-center gap-3">
                <div class="h-5 w-1.5 bg-[#eab308]"></div>
                <h2 class="text-2xl md:text-4xl font-black text-gray-900 tracking-tighter uppercase text-left">
                    Review <span class="text-gray-400">Terminal System</span>
                </h2>
            </div>
            <div class="ml-[1.15rem]">
                <p class="text-[10px] md:text-xs font-bold text-gray-400 uppercase tracking-[0.2em] text-left">
                    Feedback Analysis <span class="mx-2 text-gray-200">|</span> 
                    Digital Intelligence Quality Control
                </p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 md:gap-12">
            
            {# Left Column: Form Section #}
            <div class="lg:col-span-7" data-aos="fade-up">
                <div class="industrial-glass-card p-6 md:p-12 rounded-3xl h-full border-2 border-gray-900/10">
                    {# Aksen Siku Pojok #}
                    <div class="absolute top-0 right-0 w-12 h-12 bg-gray-200/20 -mr-6 -mt-6 rotate-45 group-hover:bg-[#eab308] transition-colors duration-500"></div>

                    <form action="{% url 'feedback_view' %}" method="POST" class="space-y-8 relative z-10">
                        {% csrf_token %}
                        
                        <div class="space-y-4">
                            <label class="text-[10px] font-black uppercase tracking-widest text-gray-900 flex items-center gap-3">
                                <span class="w-2 h-2 bg-gray-900"></span> 01. Inisialisasi Modul
                            </label>
                            <div class="relative">
                                <select name="course" required class="cyber-input w-full p-4 text-[11px] tracking-widest uppercase cursor-pointer appearance-none">
                                    <option value="" disabled selected>-- Pilih Materi Kursus --</option>
                                    {% for course in courses %}
                                        <option value="{{ course.id }}">{{ course.title }}</option>
                                    {% empty %}
                                        <option disabled>Modul tidak tersedia.</option>
                                    {% endfor %}
                                </select>
                                <div class="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-gray-900">
                                    <i class="fas fa-chevron-down text-[10px]"></i>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <label class="text-[10px] font-black uppercase tracking-widest text-gray-900 flex items-center gap-3">
                                <span class="w-2 h-2 bg-gray-900"></span> 02. Rating Kepuasan
                            </label>
                            <div class="bg-white/50 backdrop-blur-sm p-6 border-2 border-dashed border-gray-300 rounded-2xl flex justify-center">
                                <div class="star-rating">
                                    {% with latest_rating=feedbacks.0.rating %}
                                    <input type="radio" id="5" name="rating" value="5" required {% if latest_rating == 5 %}checked{% endif %}><label for="5"><i class="fas fa-star"></i></label>
                                    <input type="radio" id="4" name="rating" value="4" {% if latest_rating == 4 %}checked{% endif %}><label for="4"><i class="fas fa-star"></i></label>
                                    <input type="radio" id="3" name="rating" value="3" {% if latest_rating == 3 %}checked{% endif %}><label for="3"><i class="fas fa-star"></i></label>
                                    <input type="radio" id="2" name="rating" value="2" {% if latest_rating == 2 %}checked{% endif %}><label for="2"><i class="fas fa-star"></i></label>
                                    <input type="radio" id="1" name="rating" value="1" {% if latest_rating == 1 %}checked{% endif %}><label for="1"><i class="fas fa-star"></i></label>
                                    {% endwith %}
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <label class="text-[10px] font-black uppercase tracking-widest text-gray-900 flex items-center gap-3">
                                <span class="w-2 h-2 bg-gray-900"></span> 03. Testimoni Log
                            </label>
                            <textarea name="content" rows="4" required placeholder="INPUT PENGALAMAN BELAJAR ANDA..." 
                                class="cyber-input w-full p-4 text-[11px] tracking-widest uppercase"></textarea>
                        </div>

                        <button type="submit" class="w-full py-4 bg-gray-900 hover:bg-[#eab308] text-white hover:text-gray-900 font-black transition-all text-[10px] tracking-[0.3em] uppercase active:scale-95 shadow-[6px_6px_0px_rgba(0,0,0,0.1)] hover:shadow-none">
                            Kirim Ulasan Sekarang <i class="fas fa-paper-plane ml-2"></i>
                        </button>
                    </form>
                </div>
            </div>

            {# Right Column: History Section #}
            <div class="lg:col-span-5" data-aos="fade-left">
                <div class="sticky top-10 flex flex-col h-full">
                    <h3 class="text-[10px] font-black uppercase tracking-[0.4em] text-gray-400 mb-8 flex items-center gap-4">
                        <span class="w-2 h-2 bg-[#eab308]"></span> Recent History <div class="flex-1 h-[1px] bg-gray-200"></div>
                    </h3>
                    
                    <div class="space-y-4 overflow-y-auto max-h-[600px] pr-2 custom-scrollbar">
                        {% for fb in feedbacks %}
                        <div class="industrial-glass-card p-5 group">
                            {# Aksen Garis Dinamis Bawah Card #}
                            <div class="absolute bottom-0 left-0 h-[2px] w-0 bg-gray-900 transition-all duration-500 group-hover:w-full"></div>

                            <div class="flex justify-between items-start mb-3">
                                <div class="flex gap-1 text-[#eab308] text-[9px]">
                                    {% for i in "12345"|make_list %}
                                        <i class="fas fa-star {% if forloop.counter <= fb.rating %}text-[#eab308]{% else %}text-gray-200{% endif %}"></i>
                                    {% endfor %}
                                </div>
                                <span class="text-[7px] font-black bg-gray-900 text-[#eab308] px-2 py-0.5 border border-gray-900 uppercase">
                                    {{ fb.course.course_code }}
                                </span>
                            </div>
                            
                            <div class="mb-3">
                                <h4 class="text-[11px] font-black text-gray-900 uppercase tracking-tighter">@{{ request.user.username }}</h4>
                                <p class="text-[8px] font-bold text-gray-400 uppercase tracking-widest mt-0.5">{{ fb.course.title }}</p>
                            </div>

                            <p class="text-[10px] font-bold text-gray-500 italic leading-relaxed border-l-2 border-gray-100 pl-3">
                                {% for disc in fb.course.discussions.all %}
                                    {% if disc.user == fb.user and not disc.parent %}
                                        {% if forloop.last %}"{{ disc.content|truncatechars:90 }}"{% endif %}
                                    {% endif %}
                                {% empty %}
                                    "Memberikan rating bintang {{ fb.rating }}."
                                {% endfor %}
                            </p>
                            
                            <div class="mt-4 flex justify-between items-center text-[7px] font-black text-gray-300 uppercase tracking-[0.2em]">
                                <span>STATUS: VERIFIED</span>
                                <span>{{ fb.last_accessed|date:"d.m.Y" }}</span>
                            </div>
                        </div>
                        {% empty %}
                        <div class="industrial-glass-card p-12 border-dashed rounded-3xl text-center">
                            <i class="fas fa-terminal text-gray-200 text-3xl mb-4"></i>
                            <p class="text-[9px] font-black text-gray-400 uppercase italic tracking-widest">No feedback logs found in system.</p>
                        </div>
                        {% endfor %}
                    </div>

                    <div class="mt-8 pt-4 border-t border-gray-100">
                        <a href="{% url 'discussion_view' %}" class="text-[9px] font-black uppercase italic tracking-widest text-gray-400 hover:text-gray-900 transition-all flex items-center justify-end gap-3 group">
                            Beralih ke Forum Diskusi <i class="fas fa-arrow-right text-[8px] group-hover:translate-x-2 transition-transform"></i>
                        </a>
                    </div>
                </div>
            </div>

        </div>

        {# Footer Section - Gaya Katalog #}
        <div class="w-full mt-24 pt-8 border-t-2 border-gray-900 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-2 text-[9px] font-black text-gray-400 uppercase tracking-widest">
                <span class="w-2 h-2 bg-yellow-400"></span>
                Review Module Status: Operational
            </div>
            <div class="text-[9px] font-black text-gray-900 uppercase tracking-widest">
                SSC Industrial Version 1.0.4
            </div>
        </div>
    </div>
</div>

<script>
    AOS.init({ once: true, duration: 800, easing: 'ease-out-back' });
</script>
{% endblock content %}