{% load static %} 

<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sertifikat Kelulusan Premium - SSC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Mrs+Saint+Delafield&display=swap" rel="stylesheet">
    <style>
        @page { size: landscape; margin: 0; }
        
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f1f5f9; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh;
            margin: 0;
            /* Pencegah scroll horizontal pada mobile saat scaling */
            overflow-x: hidden; 
        }

        /* Container Pembungkus untuk Scaling Mobile */
        .cert-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Container Utama dengan Rasio A4 */
        .cert-canvas {
            width: 297mm;
            height: 210mm;
            background: white;
            position: relative;
            padding: 12mm;
            box-shadow: 0 50px 100px -20px rgba(0,0,0,0.2);
            overflow: hidden;
            flex-shrink: 0; /* Mencegah canvas gepeng */
            transform-origin: center; /* Titik pusat zoom */
        }

        /* LOGIC MENGECHIL DI HP (RESPONSIVE) */
        @media (max-width: 1200px) {
            .cert-canvas {
                /* Mengecilkan sertifikat secara proporsional sesuai lebar layar */
                transform: scale(0.6); 
            }
        }

        @media (max-width: 800px) {
            .cert-canvas {
                transform: scale(0.4);
            }
        }

        @media (max-width: 500px) {
            .cert-canvas {
                transform: scale(0.3); /* Untuk layar HP kecil */
            }
            .cert-wrapper {
                padding: 0;
                height: 350px; /* Membatasi tinggi wrapper agar tombol tidak tertutup */
            }
        }

        /* Kembalikan ke ukuran asli saat PRINT agar tidak pecah/kecil */
        @media print {
            body { background: white; padding: 0; overflow: visible; }
            .no-print { display: none; }
            .cert-wrapper { padding: 0; display: block; }
            .cert-canvas { 
                box-shadow: none; 
                border: none; 
                width: 297mm; 
                height: 210mm; 
                transform: scale(1) !important; 
                margin: 0;
            }
        }

        /* Mengatur tinggi bar agar tidak terlalu tinggi */
        .cert-wrapper {
            padding-bottom: 80px !important; 
        }
        
        /* Responsive adjustment untuk tombol di HP */
        @media (max-width: 480px) {
            .tracking-\[0\.2em\] { tracking: 0.1em; }
            .px-6 { padding-left: 1rem; padding-right: 1rem; }
        }

        /* Style desain tetap sama */
        .outer-border { position: absolute; inset: 12mm; border: 2px solid #eab308; z-index: 10; }
        .inner-border { position: absolute; inset: 16mm; border: 1px solid #eab308; opacity: 0.3; z-index: 10; }
        .cert-bg { 
            position: absolute; inset: 0; 
            background-image: url('{% static "img/1.jpeg" %}'); 
            background-size: cover; background-position: center; 
            opacity: 0.08; z-index: 0; filter: grayscale(100%); 
        }
        .corner { position: absolute; width: 80px; height: 80px; border: 6px solid #eab308; z-index: 20; }
        .corner-tl { top: 0; left: 0; border-right: 0; border-bottom: 0; }
        .corner-br { bottom: 0; right: 0; border-left: 0; border-top: 0; }
        .title-font { font-family: 'Playfair Display', serif; }
    </style>
</head>
<body>

    <div class="cert-wrapper">
        <div class="cert-canvas relative flex flex-col justify-between">
            
            <div class="cert-bg"></div>
            <div class="outer-border"></div>
            <div class="inner-border"></div>
            <div class="corner corner-tl"></div>
            <div class="corner corner-br"></div>

            <div class="relative z-20 flex justify-between items-start px-12 pt-12">
                <div class="flex items-center gap-5">
                    <div class="w-16 h-16 bg-[#eab308] flex items-center justify-center font-black text-white text-2xl shadow-xl shadow-yellow-500/20 shrink-0">
                        SSC
                    </div>
                    <div class="flex flex-col justify-center">
                        <h4 class="font-black text-gray-900 leading-tight uppercase tracking-tighter mb-1 text-lg">Smart Study Club</h4>
                        <p class="text-[9px] font-bold text-[#eab308] tracking-[0.3em] uppercase leading-none">Adaptive Learning Path</p>
                    </div>
                </div>
                
                <div class="relative w-24 h-24 flex items-center justify-center">
                    <svg class="absolute w-full h-full text-[#eab308]/20 rotate-12" viewBox="0 0 100 100">
                        <path d="M50 5 L63 35 L95 35 L70 55 L80 85 L50 65 L20 85 L30 55 L5 35 L37 35 Z" fill="currentColor"/>
                    </svg>
                    <div class="text-center relative z-10">
                        <p class="text-[8px] font-black text-gray-400 uppercase leading-none">Verified</p>
                        <p class="text-[10px] font-black text-gray-800 uppercase leading-none">2026</p>
                    </div>
                </div>
            </div>

            <div class="relative z-20 text-center px-20">
                <h1 class="title-font text-6xl text-gray-900 italic mb-2">Sertifikat Kelulusan</h1>
                <div class="w-48 h-[2px] bg-[#eab308] mx-auto mb-10"></div>
                <p class="text-gray-400 uppercase tracking-[0.4em] text-[10px] font-bold mb-6">Diberikan Sebagai Tanda Penghargaan Kepada</p>
                <h2 class="text-6xl font-black text-gray-900 tracking-tighter uppercase mb-6 drop-shadow-sm">
                    {{ user.get_full_name|default:user.username }}
                </h2>
                <div class="text-gray-600 max-w-4xl mx-auto text-lg italic font-medium border-t border-gray-100 pt-6 leading-tight">
                    <p>Dinyatakan telah memenuhi standar kualifikasi kompetensi yang ditetapkan serta berhasil menyelesaikan seluruh tahapan modul pembelajaran pada mata pelajaran</p>
                    <p class="py-1">
                        <span class="text-[#eab308] font-black not-italic uppercase tracking-tight">
                            {{ quiz.lesson.module.course.title|default:"Mata Pelajaran Unggulan" }}
                        </span>
                    </p>
                    <p class="text-gray-600 max-w-4xl mx-auto text-lg italic font-medium leading-normal">
                        melalui penilaian berbasis <span class="text-gray-900 font-bold not-italic mx-1">Item Response Theory (IRT)</span> dengan hasil yang sangat memuaskan.
                    </p>
                </div>
            </div>

            <div class="relative z-20 flex justify-between items-end px-16 pb-12">
                <div class="flex items-center gap-6"> 
                    <div class="bg-white/40 backdrop-blur-sm p-4 border-l-4 border-[#eab308]">
                        <p class="text-[9px] text-gray-500 font-black uppercase tracking-widest mb-1">Ability Score (Theta)</p>
                        <div class="flex items-baseline gap-1">
                            <span class="text-3xl font-black text-gray-900">
                                {% if theta_akhir > 0 %}+{% endif %}{{ theta_akhir|floatformat:2|default:"0.00" }}
                            </span>
                            <span class="text-[10px] font-bold text-[#eab308] uppercase">Adaptive Result</span>
                        </div>
                    </div>
                    <div class="border-l border-gray-200 pl-6"> 
                        <p class="text-[9px] text-gray-400 font-black uppercase tracking-widest mb-1">ID Verifikasi</p>
                        <p class="text-xs font-mono font-bold text-gray-600 tracking-tighter uppercase">
                            SSC-{{ quiz.pk }}{{ request.user.id }}-2026
                        </p>
                    </div>
                </div>

                <div class="text-center w-64">
                    <div class="mb-2 h-16 flex items-center justify-center relative">
                        <span class="title-font text-3xl text-gray-300 opacity-40 select-none tracking-tighter">SmartStudyClub</span>
                        <span class="absolute text-8xl text-black select-none whitespace-nowrap" 
                            style="font-family: 'Mrs Saint Delafield', cursive; 
                                    transform: rotate(-10deg) translateY(25px) translateX(-5px); 
                                    z-index: 50;
                                    letter-spacing: -2px;
                                    -webkit-text-stroke: 0.5px #000;">
                            SmartSC
                        </span>
                    </div>
                    <div class="w-full h-[1.5px] bg-gray-900 mb-2 relative z-10"></div>
                    <p class="text-[10px] text-gray-400 font-black uppercase tracking-widest mb-1">Diterbitkan Secara Digital</p>
                    <p class="text-xs font-black text-gray-900 tracking-widest uppercase">{% now "d F Y" %}</p>
                </div>
            </div>

        </div>
    </div>

    <div class="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-md border-t border-gray-100 px-6 py-3 no-print z-[100] flex justify-between items-center shadow-[0_-8px_20px_-5px_rgba(0,0,0,0.05)]">
    
    <button onclick="history.back()" class="group flex items-center gap-2 text-gray-500 hover:text-black transition-colors duration-300">
        <svg class="w-4 h-4 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
        </svg>
        <span class="font-extrabold text-[10px] uppercase tracking-[0.2em]">Kembali</span>
    </button>

    <div class="flex gap-3">
        <button onclick="downloadPDF()" class="bg-[#eab308] hover:bg-yellow-500 text-gray-900 px-6 py-2.5 rounded-xl font-extrabold text-[10px] uppercase tracking-[0.15em] transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:shadow-yellow-500/30 active:scale-95 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            Unduh
        </button>

        <button onclick="window.print()" class="bg-[#eab308] hover:bg-yellow-500 text-gray-900 px-6 py-2.5 rounded-xl font-extrabold text-[10px] uppercase tracking-[0.15em] transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:shadow-yellow-500/30 active:scale-95 flex items-center gap-2 border-l border-yellow-600/20">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
            </svg>
            Print
        </button>
    </div>
</div>

<script>
function downloadPDF() {
    const element = document.querySelector('.cert-canvas'); // Ambil bagian sertifikat saja
    const options = {
        margin: 0,
        filename: 'Sertifikat_SSC_{{ user.username }}.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true }, // High resolution
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
    };

    // Jalankan fungsi download
    html2pdf().set(options).from(element).save();
}
</script>

</body>
</html>