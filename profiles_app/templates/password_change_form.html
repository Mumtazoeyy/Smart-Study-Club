{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}Update Encryption - Smart Study Club{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'fontawesome-free-7.1.0-web/css/all.min.css' %}">
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

<style>
    body { font-family: 'Poppins', sans-serif; background-color: #ffffff; color: #111827; }
    .password-card-industrial {
        background-color: rgba(255, 255, 255, 0.05); 
        backdrop-filter: blur(12px); 
        border: 1px solid rgba(0, 0, 0, 0.1);
        position: relative;
    }
    .cyber-input {
        background: #ffffff !important;
        border: 2px solid #111827 !important;
        border-radius: 0px !important;
        font-weight: 600 !important;
        transition: all 0.2s ease;
        font-size: 0.85rem;
    }
    .cyber-input:focus {
        box-shadow: 4px 4px 0px #eab308 !important;
        transform: translate(-2px, -2px);
        outline: none;
    }
    /* Style Notifikasi */
    .alert-box {
        border-left: 4px solid #111827;
        font-weight: 800;
        text-transform: uppercase;
        font-size: 11px;
        transition: all 0.5s ease;
    }
    .eye-toggle { cursor: pointer; transition: 0.2s; }
    .eye-toggle:hover { color: #eab308; }
    .glow-dot { width: 8px; height: 8px; background: #eab308; border: 1.5px solid #111827; display: inline-block; }
</style>

<div class="container mx-auto px-6 min-h-screen pt-2 pb-16">
    {# Header #}
    <div class="w-full flex flex-col items-start gap-1 mb-12" data-aos="fade-down">
        <div class="flex items-center gap-3">
            <div class="h-8 w-1.5 bg-[#eab308]"></div>
            <h1 class="text-3xl md:text-4xl font-black text-gray-900 tracking-tighter uppercase">Security <span class="text-gray-400">Update</span></h1>
        </div>
        <p class="text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em] mt-1">Encryption Terminal / Password Overwrite Protocol</p>
    </div>

    <div class="max-w-2xl mx-auto">
        
        {# 1. BLOK NOTIFIKASI (MESSAGES) #}
        {% if messages %}
            {% for message in messages %}
            <div id="alert-{{ forloop.counter }}" class="alert-box mb-6 p-4 flex items-center justify-between {% if message.tags == 'success' %}bg-green-50 border-green-600 text-green-700{% else %}bg-red-50 border-red-600 text-red-700{% endif %} shadow-sm" data-aos="zoom-in">
                <div class="flex items-center gap-3">
                    <i class="fas {% if message.tags == 'success' %}fa-check-circle{% else %}fa-exclamation-triangle{% endif %}"></i>
                    <span>{{ message }}</span>
                </div>
                <button onclick="this.parentElement.remove()" class="opacity-50 hover:opacity-100"><i class="fas fa-times"></i></button>
            </div>
            {% endfor %}
        {% endif %}

        <div class="password-card-industrial shadow-2xl overflow-hidden" data-aos="fade-up">
            <div class="p-8 md:p-10 border-b-2 border-gray-900 bg-gray-50/50">
                <div class="flex items-center gap-2 mb-2">
                    <span class="glow-dot"></span>
                    <h3 class="text-sm font-black text-gray-900 uppercase tracking-widest">Authentication Key</h3>
                </div>
                <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Perbarui kunci enkripsi akun Anda untuk menjaga integritas data sistem.</p>
            </div>

            <form method="post" class="p-8 md:p-10 space-y-8">
                {% csrf_token %}
                <div class="space-y-6">
                    {% for field in form %}
                    <div class="form-group space-y-2">
                        <label class="block text-[10px] font-black text-gray-900 uppercase tracking-widest">{{ field.label }}</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-400"><i class="fas fa-lock text-[10px]"></i></div>
                            {% render_field field class="cyber-input w-full pl-10 pr-12 py-3" placeholder="Enter sequence..." %}
                            {# 2. TOMBOL MATA #}
                            <button type="button" onclick="togglePassword(this)" class="absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 eye-toggle focus:outline-none">
                                <i class="fas fa-eye text-[12px]"></i>
                            </button>
                        </div>
                        {% if field.errors %}
                        <p class="text-red-600 text-[9px] font-black uppercase mt-1"><i class="fas fa-exclamation-triangle mr-1"></i> {{ field.errors.0 }}</p>
                        {% endif %}
                        {% if field.help_text %}<p class="text-gray-400 text-[10px] font-medium italic">{{ field.help_text|safe }}</p>{% endif %}
                    </div>
                    {% endfor %}
                </div>

                <div class="pt-6 flex flex-col sm:flex-row items-center justify-between gap-6 border-t border-gray-100">
                    <a href="{% url 'profile_settings' %}" class="text-[10px] font-black text-gray-400 hover:text-gray-900 uppercase tracking-[0.2em] order-2 sm:order-1">back to profile settings</a>
                    <button type="submit" class="w-full sm:w-auto px-10 py-4 bg-gray-900 text-white text-[11px] font-black uppercase tracking-[0.2em] border-2 border-gray-900 hover:bg-[#eab308] hover:text-gray-900 transition-all shadow-[6px_6px_0px_#eab308] active:translate-y-1 order-1 sm:order-2">
                        Overwrite Password <i class="fas fa-key ml-2"></i>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    AOS.init({ once: true, duration: 800 });

    // Toggle Mata Password
    function togglePassword(button) {
        const input = button.parentElement.querySelector('input');
        const icon = button.querySelector('i');
        if (input.type === "password") {
            input.type = "text";
            icon.className = 'fas fa-eye-slash text-[12px]';
        } else {
            input.type = "password";
            icon.className = 'fas fa-eye text-[12px]';
        }
    }

    // 3. SCRIPT AUTO-HIDE NOTIFIKASI
    setTimeout(function() {
        let alerts = document.querySelectorAll('.alert-box');
        alerts.forEach(function(alert) {
            alert.style.opacity = "0";
            setTimeout(() => alert.remove(), 500);
        });
    }, 5000);
</script>
{% endblock %}